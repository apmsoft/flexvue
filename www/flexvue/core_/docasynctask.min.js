const DocAsyncTask={version:"1.2.4",doGetContents(e,t,l){let n=this,o=null!==l&&"function"==typeof l.success?l.success:null,a=null!==l&&"function"==typeof l.fail?l.fail:null,r=e.frame,c=e.template;n.doPrintFrameHtml(r,function(){n.doFetchData(e,t,function(e){"true"==e.result?n.doTemplateRender(c,e,function(t){null!==o&&o(t,e)}):"false"==e.result&&null!==a&&a(e)})})},doPrintFrameHtml(e,t){if(null!==e)if(e.indexOf("#")>-1){let l=e.split("#"),n=l[0],o=l[1];require(["text!"+n+".html"],function(e){Promise.resolve(document.querySelector("#"+o).innerHTML=e).then(function(){t()})})}else t();else t()},async doFetchData(e,t,l){let n={};if(null===e.value)n={result:"true",msg:""},l(n);else if("object"==typeof e.value)n=Object.assign({result:"true",msg:""},e.value),l(n);else{let o=e.value;null!==app.server_language&&""!=app.server_language&&(o=`${o}${app.server_language}`),null!==app.src&&""!=app.src&&(o=`${app.src}/${o}`);let a=Object.entries(t).map(([e,t])=>`${e}=${encodeURIComponent(t)}`).join("&");o=`${o}?${a}`;let r={method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Accept:"application/json"}};app.log(o);try{const e=await fetch(o,r);if(!e.ok)throw Error(e.text());if(e.ok){let t=e.clone();try{n=await e.json(),l(n)}catch(e){console.log("error:",t.text())}}}catch(e){app.log(e)}}},doTemplateRender(e,t,l){let n="";if(null!==e){if(e.indexOf("#")>-1){let t=e.split("#");e=t[0],n=t[1]}if("included"==e){let e=document.querySelector("script#"+n).innerText;l(template(e,t))}else{let o=app.template.length,a=!1;for(let t=0;t<o;t++)if(null!=app.template[t]&&app.template[t]==e){a=!0;break}if(a){let e=document.querySelector("script#"+n).innerText;l(template(e,t))}else require(["text!"+e+".html"],function(a){app.template[o]=e,Promise.resolve(document.querySelector("body").insertAdjacentHTML("afterend",a)).then(function(){let e=document.querySelector("script#"+n).innerText;l(template(e,t))})})}}else l(null)},async doPostMessage(e,t,l){let n=null!==l&&"function"==typeof l.success?l.success:null,o=null!==l&&"function"==typeof l.fail?l.fail:null,a=e;null!==app.server_language&&""!=app.server_language&&(a=`${a}${app.server_language}`),null!==app.src&&""!=app.src&&(a=`${app.src}/${a}`);let r={method:void 0!==t.id&&null!==t.id?"PUT":"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)},c={};app.log(a);try{const e=await fetch(a,r);if(!e.ok)throw Error(e.statusText);if(e.ok){let t=e.clone();try{c=await e.json(),"true"==c.result?null!==n&&n(c):"false"==c.result&&null!==o&&o(c)}catch(e){console.log("error:",t.text())}}}catch(e){app.log(e)}},doSubmit(e,t){let l=null;const n=document.querySelector(e);n.addEventListener("submit",function(e){e.preventDefault(),l={};const o=new FormData(n);o.forEach((e,t)=>{let o=n.elements[t].length>1?n.elements[t][0].nodeName:n.elements[t].nodeName,a="TEXTAREA"==o?encodeURIComponent(e):e;l[t]=void 0!==l[t]&&""!=l[t]?`${l[t]},${a}`:a}),app.log("//--submit--->"),app.log(l),app.log("<---------//"),"function"==typeof t&&t(l)})}};