var _doc,_win,_docElement,_body,_divContainer,_svgContainer,_identityMatrix,_gEl,_hasOffsetBug,_transformProp="transform",_transformOriginProp=_transformProp+"Origin",_setDoc=function(t){var e=t.ownerDocument||t;!(_transformProp in t.style)&&"msTransform"in t.style&&(_transformProp="msTransform",_transformOriginProp=_transformProp+"Origin");for(;e.parentNode&&(e=e.parentNode););if(_win=window,_identityMatrix=new Matrix2D,e){_doc=e,_docElement=e.documentElement,_body=e.body,_gEl=_doc.createElementNS("http://www.w3.org/2000/svg","g"),_gEl.style.transform="none";var r=e.createElement("div"),o=e.createElement("div");_body.appendChild(r),r.appendChild(o),r.style.position="static",r.style[_transformProp]="translate3d(0,0,1px)",_hasOffsetBug=o.offsetParent!==r,_body.removeChild(r)}return e},_forceNonZeroScale=function(t){for(var e,r;t&&t!==_body;)r=t._gsap,r&&r.uncache&&r.get(t,"x"),r&&!r.scaleX&&!r.scaleY&&r.renderTransform&&(r.scaleX=r.scaleY=1e-4,r.renderTransform(1,r),e?e.push(r):e=[r]),t=t.parentNode;return e},_svgTemps=[],_divTemps=[],_getDocScrollTop=function(){return _win.pageYOffset||_doc.scrollTop||_docElement.scrollTop||_body.scrollTop||0},_getDocScrollLeft=function(){return _win.pageXOffset||_doc.scrollLeft||_docElement.scrollLeft||_body.scrollLeft||0},_svgOwner=function(t){return t.ownerSVGElement||("svg"===(t.tagName+"").toLowerCase()?t:null)},_isFixed=function t(e){return"fixed"===_win.getComputedStyle(e).position||(e=e.parentNode,e&&1===e.nodeType?t(e):void 0)},_createSibling=function t(e,r){if(e.parentNode&&(_doc||_setDoc(e))){var o=_svgOwner(e),n=o?o.getAttribute("xmlns")||"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",i=o?r?"rect":"g":"div",s=2!==r?0:100,a=3===r?100:0,l="position:absolute;display:block;pointer-events:none;margin:0;padding:0;",f=_doc.createElementNS?_doc.createElementNS(n.replace(/^https/,"http"),i):_doc.createElement(i);return r&&(o?(_svgContainer||(_svgContainer=t(e)),f.setAttribute("width",.01),f.setAttribute("height",.01),f.setAttribute("transform","translate("+s+","+a+")"),_svgContainer.appendChild(f)):(_divContainer||(_divContainer=t(e),_divContainer.style.cssText=l),f.style.cssText=l+"width:0.1px;height:0.1px;top:"+a+"px;left:"+s+"px",_divContainer.appendChild(f))),f}throw"Need document and parent."},_consolidate=function(t){for(var e=new Matrix2D,r=0;r<t.numberOfItems;r++)e.multiply(t.getItem(r).matrix);return e},_getCTM=function(t){var e,r=t.getCTM();return r||(e=t.style[_transformProp],t.style[_transformProp]="none",t.appendChild(_gEl),r=_gEl.getCTM(),t.removeChild(_gEl),e?t.style[_transformProp]=e:t.style.removeProperty(_transformProp.replace(/([A-Z])/g,"-$1").toLowerCase())),r||_identityMatrix.clone()},_placeSiblings=function(t,e){var r,o,n,i,s,a,l=_svgOwner(t),f=t===l,d=l?_svgTemps:_divTemps,_=t.parentNode;if(t===_win)return t;if(d.length||d.push(_createSibling(t,1),_createSibling(t,2),_createSibling(t,3)),r=l?_svgContainer:_divContainer,l)f?(n=_getCTM(t),i=-n.e/n.a,s=-n.f/n.d,o=_identityMatrix):(n=t.getBBox(),o=t.transform?t.transform.baseVal:{},o=o.numberOfItems?o.numberOfItems>1?_consolidate(o):o.getItem(0).matrix:_identityMatrix,i=o.a*n.x+o.c*n.y,s=o.b*n.x+o.d*n.y),e&&"g"===t.tagName.toLowerCase()&&(i=s=0),(f?l:_).appendChild(r),r.setAttribute("transform","matrix("+o.a+","+o.b+","+o.c+","+o.d+","+(o.e+i)+","+(o.f+s)+")");else{if(i=s=0,_hasOffsetBug)for(o=t.offsetParent,n=t;n&&(n=n.parentNode)&&n!==o&&n.parentNode;)(_win.getComputedStyle(n)[_transformProp]+"").length>4&&(i=n.offsetLeft,s=n.offsetTop,n=0);if(a=_win.getComputedStyle(t),"absolute"!==a.position&&"fixed"!==a.position)for(o=t.offsetParent;_&&_!==o;)i+=_.scrollLeft||0,s+=_.scrollTop||0,_=_.parentNode;n=r.style,n.top=t.offsetTop-s+"px",n.left=t.offsetLeft-i+"px",n[_transformProp]=a[_transformProp],n[_transformOriginProp]=a[_transformOriginProp],n.position="fixed"===a.position?"fixed":"absolute",t.parentNode.appendChild(r)}return r},_setMatrix=function(t,e,r,o,n,i,s){return t.a=e,t.b=r,t.c=o,t.d=n,t.e=i,t.f=s,t};export var Matrix2D=function(){function t(t,e,r,o,n,i){void 0===t&&(t=1),void 0===e&&(e=0),void 0===r&&(r=0),void 0===o&&(o=1),void 0===n&&(n=0),void 0===i&&(i=0),_setMatrix(this,t,e,r,o,n,i)}var e=t.prototype;return e.inverse=function(){var t=this.a,e=this.b,r=this.c,o=this.d,n=this.e,i=this.f,s=t*o-e*r||1e-10;return _setMatrix(this,o/s,-e/s,-r/s,t/s,(r*i-o*n)/s,-(t*i-e*n)/s)},e.multiply=function(t){var e=this.a,r=this.b,o=this.c,n=this.d,i=this.e,s=this.f,a=t.a,l=t.c,f=t.b,d=t.d,_=t.e,p=t.f;return _setMatrix(this,a*e+f*o,a*r+f*n,l*e+d*o,l*r+d*n,i+_*e+p*o,s+_*r+p*n)},e.clone=function(){return new t(this.a,this.b,this.c,this.d,this.e,this.f)},e.equals=function(t){var e=this.a,r=this.b,o=this.c,n=this.d,i=this.e,s=this.f;return e===t.a&&r===t.b&&o===t.c&&n===t.d&&i===t.e&&s===t.f},e.apply=function(t,e){void 0===e&&(e={});var r=t.x,o=t.y,n=this.a,i=this.b,s=this.c,a=this.d,l=this.e,f=this.f;return e.x=r*n+o*s+l||0,e.y=r*i+o*a+f||0,e},t}();export function getGlobalMatrix(t,e,r,o){if(!t||!t.parentNode||(_doc||_setDoc(t)).documentElement===t)return new Matrix2D;var n=_forceNonZeroScale(t),i=_svgOwner(t),s=i?_svgTemps:_divTemps,a=_placeSiblings(t,r),l=s[0].getBoundingClientRect(),f=s[1].getBoundingClientRect(),d=s[2].getBoundingClientRect(),_=a.parentNode,p=!o&&_isFixed(t),c=new Matrix2D((f.left-l.left)/100,(f.top-l.top)/100,(d.left-l.left)/100,(d.top-l.top)/100,l.left+(p?0:_getDocScrollLeft()),l.top+(p?0:_getDocScrollTop()));if(_.removeChild(a),n)for(l=n.length;l--;)f=n[l],f.scaleX=f.scaleY=0,f.renderTransform(1,f);return e?c.inverse():c}export{_getDocScrollTop,_getDocScrollLeft,_setDoc,_isFixed,_getCTM};