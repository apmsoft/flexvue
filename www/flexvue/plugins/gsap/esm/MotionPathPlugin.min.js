import{getRawPath,cacheRawPathMeasurements,getPositionOnPath,pointsToSegment,flatPointsToSegment,sliceRawPath,stringToRawPath,rawPathToString,transformRawPath,convertToPath as _convertToPath}from"./utils/paths.min.js";import{getGlobalMatrix}from"./utils/matrix.min.js";var gsap,PropTween,_getUnit,_toArray,_xProps="x,translateX,left,marginLeft,xPercent".split(","),_yProps="y,translateY,top,marginTop,yPercent".split(","),_DEG2RAD=Math.PI/180,_getGSAP=function(){return gsap||"undefined"!=typeof window&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_populateSegmentFromArray=function(t,e,a,r){for(var n=e.length,i=2===r?0:r,o=0;o<n;o++)t[i]=parseFloat(e[o][a]),2===r&&(t[i+1]=0),i+=2;return t},_getPropNum=function(t,e,a){return parseFloat(t._gsap.get(t,e,a||"px"))||0},_relativize=function(t){var e,a=t[0],r=t[1];for(e=2;e<t.length;e+=2)a=t[e]+=a,r=t[e+1]+=r},_segmentToRawPath=function(t,e,a,r,n,i,o,s,g){if("cubic"===o.type)e=[e];else{!1!==o.fromCurrent&&e.unshift(_getPropNum(a,r,s),n?_getPropNum(a,n,g):0),o.relative&&_relativize(e);var p=n?pointsToSegment:flatPointsToSegment;e=[p(e,o.curviness)]}return e=i(_align(e,a,o)),_addDimensionalPropTween(t,a,r,e,"x",s),n&&_addDimensionalPropTween(t,a,n,e,"y",g),cacheRawPathMeasurements(e,o.resolution||(0===o.curviness?20:12))},_emptyFunc=function(t){return t},_numExp=/[-+\.]*\d+\.?(?:e-|e\+)?\d*/g,_originToPoint=function(t,e,a){var r,n=getGlobalMatrix(t),i=0,o=0;return"svg"===(t.tagName+"").toLowerCase()?(r=t.viewBox.baseVal,r.width||(r={width:+t.getAttribute("width"),height:+t.getAttribute("height")})):r=e&&t.getBBox&&t.getBBox(),e&&"auto"!==e&&(i=e.push?e[0]*(r?r.width:t.offsetWidth||0):e.x,o=e.push?e[1]*(r?r.height:t.offsetHeight||0):e.y),a.apply(i||o?n.apply({x:i,y:o}):{x:n.e,y:n.f})},_getAlignMatrix=function(t,e,a,r){var n,i=getGlobalMatrix(t.parentNode,!0,!0),o=i.clone().multiply(getGlobalMatrix(e)),s=_originToPoint(t,a,i),g=_originToPoint(e,r,i),p=g.x,u=g.y;return o.e=o.f=0,"auto"===r&&e.getTotalLength&&"path"===e.tagName.toLowerCase()&&(n=e.getAttribute("d").match(_numExp)||[],n=o.apply({x:+n[0],y:+n[1]}),p+=n.x,u+=n.y),(n||e.getBBox&&t.getBBox&&e.ownerSVGElement===t.ownerSVGElement)&&(n=o.apply(e.getBBox()),p-=n.x,u-=n.y),o.e=p-s.x,o.f=u-s.y,o},_align=function(t,e,a){var r,n,i,o=a.align,s=a.matrix,g=a.offsetX,p=a.offsetY,u=a.alignOrigin,h=t[0][0],l=t[0][1],P=_getPropNum(e,"x"),f=_getPropNum(e,"y");return t&&t.length?(o&&("self"===o||(r=_toArray(o)[0]||e)===e?transformRawPath(t,1,0,0,1,P-h,f-l):(u&&!1!==u[2]?gsap.set(e,{transformOrigin:100*u[0]+"% "+100*u[1]+"%"}):u=[_getPropNum(e,"xPercent")/-100,_getPropNum(e,"yPercent")/-100],n=_getAlignMatrix(e,r,u,"auto"),i=n.apply({x:h,y:l}),transformRawPath(t,n.a,n.b,n.c,n.d,P+n.e-(i.x-n.e),f+n.f-(i.y-n.f)))),s?transformRawPath(t,s.a,s.b,s.c,s.d,s.e,s.f):(g||p)&&transformRawPath(t,1,0,0,1,g||0,p||0),t):getRawPath("M0,0L0,0")},_addDimensionalPropTween=function(t,e,a,r,n,i){var o=e._gsap,s=o.harness,g=s&&s.aliases&&s.aliases[a],p=g&&g.indexOf(",")<0?g:a,u=t._pt=new PropTween(t._pt,e,p,0,0,_emptyFunc,0,o.set(e,p,t));u.u=_getUnit(o.get(e,p,i))||0,u.path=r,u.pp=n,t._props.push(p)},_sliceModifier=function(t,e){return function(a){return t||1!==e?sliceRawPath(a,t,e):a}};export var MotionPathPlugin={version:"3.8.0",name:"motionPath",register:function(t,e,a){gsap=t,_getUnit=gsap.utils.getUnit,_toArray=gsap.utils.toArray,PropTween=a},init:function(t,e){if(!gsap)return console.warn("Please gsap.registerPlugin(MotionPathPlugin)"),!1;"object"==typeof e&&!e.style&&e.path||(e={path:e});var a,r,n=[],i=e,o=i.path,s=i.autoRotate,g=i.unitX,p=i.unitY,u=i.x,h=i.y,l=o[0],P=_sliceModifier(e.start,"end"in e?e.end:1);if(this.rawPaths=n,this.target=t,(this.rotate=s||0===s)&&(this.rOffset=parseFloat(s)||0,this.radians=!!e.useRadians,this.rProp=e.rotation||"rotation",this.rSet=t._gsap.set(t,this.rProp,this),this.ru=_getUnit(t._gsap.get(t,this.rProp))||0),!Array.isArray(o)||"closed"in o||"number"==typeof l)a=P(_align(getRawPath(e.path),t,e)),cacheRawPathMeasurements(a,e.resolution),n.push(a),_addDimensionalPropTween(this,t,e.x||"x",a,"x",e.unitX||"px"),_addDimensionalPropTween(this,t,e.y||"y",a,"y",e.unitY||"px");else{for(r in l)!u&&~_xProps.indexOf(r)?u=r:!h&&~_yProps.indexOf(r)&&(h=r);for(r in u&&h?n.push(_segmentToRawPath(this,_populateSegmentFromArray(_populateSegmentFromArray([],o,u,0),o,h,1),t,u,h,P,e,g||_getUnit(o[0][u]),p||_getUnit(o[0][h]))):u=h=0,l)r!==u&&r!==h&&n.push(_segmentToRawPath(this,_populateSegmentFromArray([],o,r,2),t,r,0,P,e,_getUnit(o[0][r])))}},render:function(t,e){var a=e.rawPaths,r=a.length,n=e._pt;for(t>1?t=1:t<0&&(t=0);r--;)getPositionOnPath(a[r],t,!r&&e.rotate,a[r]);for(;n;)n.set(n.t,n.p,n.path[n.pp]+n.u,n.d,t),n=n._next;e.rotate&&e.rSet(e.target,e.rProp,a[0].angle*(e.radians?_DEG2RAD:1)+e.rOffset+e.ru,e,t)},getLength:function(t){return cacheRawPathMeasurements(getRawPath(t)).totalLength},sliceRawPath:sliceRawPath,getRawPath:getRawPath,pointsToSegment:pointsToSegment,stringToRawPath:stringToRawPath,rawPathToString:rawPathToString,transformRawPath:transformRawPath,getGlobalMatrix:getGlobalMatrix,getPositionOnPath:getPositionOnPath,cacheRawPathMeasurements:cacheRawPathMeasurements,convertToPath:function(t,e){return _toArray(t).map(function(t){return _convertToPath(t,!1!==e)})},convertCoordinates:function(t,e,a){var r=getGlobalMatrix(e,!0,!0).multiply(getGlobalMatrix(t));return a?r.apply(a):r},getAlignMatrix:_getAlignMatrix,getRelativePosition:function(t,e,a,r){var n=_getAlignMatrix(t,e,a,r);return{x:n.e,y:n.f}},arrayToRawPath:function(t,e){e=e||{};var a=_populateSegmentFromArray(_populateSegmentFromArray([],t,e.x||"x",0),t,e.y||"y",1);return e.relative&&_relativize(a),["cubic"===e.type?a:pointsToSegment(a,e.curviness)]}};_getGSAP()&&gsap.registerPlugin(MotionPathPlugin);export{MotionPathPlugin as default};